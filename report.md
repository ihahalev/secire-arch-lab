# Review —à–∞–±–ª–æ–Ω—É —Å–∏—Å—Ç–µ–º–∏: –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è–ª—å–Ω—ñ—Å—Ç—å

**–í–∏—Ö—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏ (–∑ —à–∞–±–ª–æ–Ω—É):** `main.py`, `Dockerfile`, `deployment.yaml`, `ci.yml`, `terraform/main.tf`, `terraform/variables.tf`, `README.md`, `lab.md`

–ù–∏–∂—á–µ ‚Äî –º—ñ–Ω—ñ–º—É–º **5** –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏—Ö –ø–æ—Ä—É—à–µ–Ω—å —ñ–∑ —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —Ç–æ–º—É, **—è–∫—ñ —Å–∏–≥–Ω–∞–ª–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ**, —è–∫–∏–π **–ø—Ä–∏–Ω—Ü–∏–ø/–ø–∞—Ç–µ—Ä–Ω** –ø–æ—Ä—É—à–µ–Ω–æ, —ñ —â–æ —Å–∞–º–µ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç–∞–∫, —â–æ–± —Å–∏—Å—Ç–µ–º—É –º–æ–∂–Ω–∞ –±—É–ª–æ **–ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –≥–µ–π—Ç–∞–º–∏** (CI/policy-as-code) —ñ **–∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏** (runtime).

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: –ù–µ–º–∞—î –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É API —Ç–∞ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó (–Ω–µ–º–∞ ‚Äú—Å–∏–≥–Ω–∞–ª—É‚Äù —â–æ —î –∫–æ—Ä–µ–∫—Ç–Ω–∏–º)

**–§–∞–π–ª:** `main.py`

**–§—Ä–∞–≥–º–µ–Ω—Ç (—è–∫ —É —à–∞–±–ª–æ–Ω—ñ):**
```python
@app.get("/user")
def get_user(id):
    # ‚ùå no typing, no response_model, no validation
    return {"id": id, "name": "Alice"}
```

**–Ø–∫–∏–π —Å–∏–≥–Ω–∞–ª/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
- –°—Ö–µ–º–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤/–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π (Pydantic + `response_model`)
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç —è–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç (OpenAPI JSON) –¥–ª—è contract-tests
- –¢–∏–ø—ñ–∑–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (—â–æ–± SAST/–ª—ñ–Ω—Ç–µ—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ –ª–æ–≤–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏)

**–ü–æ—Ä—É—à–µ–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø / –ø–∞—Ç–µ—Ä–Ω**
- **‚Äú–ù–µ–≤–∏–¥–∏–º—ñ—Å—Ç—å‚Äù**: —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø—ñ–¥–∫–∞–∑—É—î, —â–æ —î ‚Äú–ø—Ä–∞–≤–∏–ª—å–Ω–∏–º‚Äù —Ñ–æ—Ä–º–∞—Ç–æ–º –¥–∞–Ω–∏—Ö
- **Fail-fast**: –ø–æ–º–∏–ª–∫–∏ –¥–∞–Ω–∏—Ö –≤–∏–ª—ñ–∑—É—Ç—å —É runtime, –∞ –Ω–µ –Ω–∞ –≥–µ–π—Ç–∞—Ö

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**
- –í–≤–µ—Å—Ç–∏ Pydantic-–º–æ–¥–µ–ª—ñ (`UserOut`, `LoginIn`, ‚Ä¶)
- –î–æ–¥–∞—Ç–∏ `response_model`, —Ç–∏–ø–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (`id: int`)
- –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ OpenAPI (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `GET /openapi.json`) —ñ —Ä–æ–±–∏—Ç–∏ contract-check —É CI

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –ù–µ–±–µ–∑–ø–µ—á–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥ JSON + ‚Äú—Å–µ–∫—Ä–µ—Ç —É –∫–æ–¥—ñ‚Äù (–æ–±—Ö—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—é)

**–§–∞–π–ª:** `main.py`

**–§—Ä–∞–≥–º–µ–Ω—Ç (—è–∫ —É —à–∞–±–ª–æ–Ω—ñ):**
```python
@app.post("/login")
def login(request: Request):
    data = request.json()  # ‚ùå no schema, unsafe parsing
    if data["password"] == "secret":
        return {"status": "ok"}
```

**–Ø–∫–∏–π —Å–∏–≥–Ω–∞–ª/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ `LoginIn` (—â–æ–± `password`/`username` –±—É–ª–∏ –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –π –º–∞–ª–∏ –ø—Ä–∞–≤–∏–ª–∞)
- –ó–∞–±–æ—Ä–æ–Ω–∞ hardcoded credentials (Semgrep rule / —Å–µ–∫—Ä–µ—Ç-—Å–∫–∞–Ω)
- –ê—É–¥–∏—Ç auth-–ø–æ–¥—ñ–π (—É—Å–ø—ñ—Ö/—Ñ–µ–π–ª –ª–æ–≥—ñ–Ω—ñ–≤), –∫–æ—Ä–µ–ª—è—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤

**–ü–æ—Ä—É—à–µ–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø / –ø–∞—Ç–µ—Ä–Ω**
- **Secure-by-default**: –≤—Ö—ñ–¥ –¥–æ–∑–≤–æ–ª—è—î –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- **Separation of concerns**: auth –ª–æ–≥—ñ–∫–∞ ‚Äú–∑–º—ñ—à–∞–Ω–∞‚Äù –∑ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º, –Ω–µ–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**
- `login(payload: LoginIn)` –∑–∞–º—ñ—Å—Ç—å `Request.json()`
- –ü–∞—Ä–æ–ª—å/—Ö–µ—à ‚Äî **–ª–∏—à–µ –∑ Secret/Vault**, –Ω–µ –∑ –∫–æ–¥—É
- –õ–æ–≥—É–≤–∞—Ç–∏ security events: `auth.login.success|fail`

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ3: –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ –ø–æ—Ä—Ç–∏ —Ç–∞ health-check (—Å–∏—Å—Ç–µ–º–∞ ‚Äú—Å–∞–º–∞ —Å–µ–±–µ –ª–∞–º–∞—î‚Äù)

**–§–∞–π–ª–∏:** `Dockerfile`, `deployment.yaml`

**–§—Ä–∞–≥–º–µ–Ω—Ç–∏ (—è–∫ —É —à–∞–±–ª–æ–Ω—ñ):**
- `Dockerfile` –∑–∞–ø—É—Å–∫–∞—î –Ω–∞ `8000`:
```dockerfile
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

- `deployment.yaml` –æ—á—ñ–∫—É—î `8080` —ñ `/health`:
```yaml
ports:
  - containerPort: 8080
livenessProbe:
  httpGet:
    path: /health
    port: 8080
```

**–Ø–∫–∏–π —Å–∏–≥–Ω–∞–ª/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
- CI –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ –º–∞–Ω—ñ—Ñ–µ—Å—Ç—ñ–≤ (kube-linter/kube-score)
- –ù–∞—è–≤–Ω—ñ—Å—Ç—å endpoint‚Äô—ñ–≤ `/health`/`/ready` —É –¥–æ–¥–∞—Ç–∫—É —è–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É runtime

**–ü–æ—Ä—É—à–µ–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø / –ø–∞—Ç–µ—Ä–Ω**
- **–ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å**: –±–µ–∑ —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ health-–ø—Ä–æ—Ç–æ–∫–æ–ª—É —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —î –∫–µ—Ä–æ–≤–∞–Ω–æ—é
- **Reproducibility**: —Ä—ñ–∑–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏ ‚Äú–¥–æ–º–æ–≤–∏–ª–∏—Å—å –ø—Ä–æ —Ä—ñ–∑–Ω–µ‚Äù

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑—É–≤–∞—Ç–∏ –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `8000`) —ñ health endpoint (`/health`)
- –î–æ–¥–∞—Ç–∏ `readinessProbe` + `livenessProbe`
- –î–æ–¥–∞—Ç–∏ CI –≥–µ–π—Ç –Ω–∞ kube-linter/kube-score

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ4: Dockerfile –Ω–µ –ø—ñ–¥ supply-chain –∫–æ–Ω—Ç—Ä–æ–ª–µ–º (–Ω–µ–º–∞ SBOM/—Å–∫–∞–Ω—ñ–≤/PoLP)

**–§–∞–π–ª:** `Dockerfile`

**–§—Ä–∞–≥–º–µ–Ω—Ç (—è–∫ —É —à–∞–±–ª–æ–Ω—ñ):**
```dockerfile
FROM python:3.10
RUN pip install fastapi uvicorn
```

**–Ø–∫–∏–π —Å–∏–≥–Ω–∞–ª/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
- Pin –≤–µ—Ä—Å—ñ–π –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (–∫–µ—Ä–æ–≤–∞–Ω—ñ—Å—Ç—å, –≤—ñ–¥—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ—Å—Ç—å)
- Image scanning (Trivy) —è–∫ –≥–µ–π—Ç
- –ó–∞–ø—É—Å–∫ –≤—ñ–¥ non-root (policy check —É CI/OPA)
- SBOM (Syft) / –ø—ñ–¥–ø–∏—Å –æ–±—Ä–∞–∑—É (Cosign) ‚Äî —Ö–æ—á–∞ –± –Ω–∞ —Ä—ñ–≤–Ω—ñ –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω—É

**–ü–æ—Ä—É—à–µ–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø / –ø–∞—Ç–µ—Ä–Ω**
- **Supply-chain security**
- **PoLP** (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–∑–≤–∏—á–∞–π –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —è–∫ root)

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**
- `python:3.12-slim` + non-root user
- `requirements.txt` –∑ pinned/ranged –≤–µ—Ä—Å—ñ—è–º–∏
- CI: `trivy fs` + `trivy image` + (–æ–ø—Ü—ñ–π–Ω–æ) SBOM

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ5: CI –Ω–µ —î –±–µ–∑–ø–µ–∫–æ–≤–∏–º —à–ª—é–∑–æ–º (–Ω–µ–º–∞ –≥–µ–π—Ç—ñ–≤)

**–§–∞–π–ª:** `ci.yml`

**–§—Ä–∞–≥–º–µ–Ω—Ç (—è–∫ —É —à–∞–±–ª–æ–Ω—ñ):**
```yaml
- name: Build container
  run: docker build -t user-api .
```

**–Ø–∫–∏–π —Å–∏–≥–Ω–∞–ª/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
- Secret scanning (gitleaks)
- SAST (Semgrep)
- Dependency scan (pip-audit / osv-scanner)
- IaC scan (checkov/tfsec)
- Container scan (Trivy)

**–ü–æ—Ä—É—à–µ–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø / –ø–∞—Ç–µ—Ä–Ω**
- **Shift-left security**
- **Gatekeeping**: –Ω–µ–º–æ–∂–ª–∏–≤–æ –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏, —â–æ ‚Äú–ø–æ–≥–∞–Ω–µ‚Äù –Ω–µ –ø—Ä–æ–π–¥–µ

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**
- –î–æ–¥–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π job `security` –∑ –æ–±–æ–≤ º—è–∑–∫–æ–≤–∏–º–∏ —Å–∫–∞–Ω–∞–º–∏
- ‚ÄúFail pipeline‚Äù –Ω–∞ HIGH/CRITICAL —Ç–∞ –Ω–∞ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö —Å–µ–∫—Ä–µ—Ç–∞—Ö
- –ó—Ä–æ–±–∏—Ç–∏ jobs required —á–µ—Ä–µ–∑ branch protection (–Ω–∞ GitHub)

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ6: Terraform –≤—ñ–¥–∫—Ä–∏–≤–∞—î –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–∞–∑–æ–≤–Ω—ñ –±–µ–∑ guardrails

**–§–∞–π–ª:** `terraform/main.tf`

**–§—Ä–∞–≥–º–µ–Ω—Ç (—è–∫ —É —à–∞–±–ª–æ–Ω—ñ):**
```hcl
cidr_blocks = ["0.0.0.0/0"]  # ‚ùå –≤—ñ–¥–∫—Ä–∏—Ç–∞ –∑–æ–Ω–∞
```

**–Ø–∫–∏–π —Å–∏–≥–Ω–∞–ª/–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
- IaC security scan (checkov/tfsec) –Ω–∞ PR
- Policy-as-code –Ω–∞ `plan` (OPA/Conftest ‚Äî —è–∫ –±–æ–Ω—É—Å)
- –ó–º—ñ–Ω–Ω—ñ/allowlist (—â–æ–± –±—É–ª–æ ‚Äú–±–µ–∑–ø–µ—á–Ω–µ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º‚Äù)

**–ü–æ—Ä—É—à–µ–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø / –ø–∞—Ç–µ—Ä–Ω**
- **PoLP** —ñ **secure defaults**
- Defense-in-depth (–Ω–µ–º–∞ –º–µ—Ä–µ–∂–µ–≤–æ–≥–æ –±–∞—Ä º—î—Ä—É)

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**
- `allowed_ingress_cidrs` —è–∫ variable (allowlist)
- –ó–∞–±–æ—Ä–æ–Ω–∞ `0.0.0.0/0` policy-–ø—Ä–∞–≤–∏–ª–æ–º
- CI: checkov/tfsec —è–∫ required job

---

# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏—Ö —Å–∏–≥–Ω–∞–ª—ñ–≤

| üî¶ –°–∏–≥–Ω–∞–ª                                  | –Ñ / –ù–µ–º–∞—î | –ö–æ–º–µ–Ω—Ç–∞—Ä |
|--------------------------------------------|-----------|----------|
| OpenAPI / `response_model`                  | ‚ùå        | –ù–µ–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É ‚Üí –Ω–µ–º–∞ contract-tests |
| –¢–∏–ø—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö (Pydantic)                  | ‚ùå        | –í—Ö—ñ–¥/–≤–∏—Ö—ñ–¥ –Ω–µ –≤–∞–ª—ñ–¥–æ–≤–∞–Ω—ñ |
| Secrets —á–µ—Ä–µ–∑ SecretRef / Vault / CSI       | ‚ö†Ô∏è        | –£ `deployment.yaml` —î `secretRef`, –∞–ª–µ –≤ –∫–æ–¥—ñ —î hardcoded ‚Äúsecret‚Äù |
| CI –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (Trivy, Semgrep, gitleaks)     | ‚ùå        | CI –ª–∏—à–µ –∑–±–∏—Ä–∞—î –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| IaC scanning (checkov/tfsec)                | ‚ùå        | Terraform –¥–æ–∑–≤–æ–ª—è—î 0.0.0.0/0 |
| OPA / policy-as-code                        | ‚ùå        | –ù–µ–º–∞ –ø—Ä–∏–º—É—Å—É PoLP/–∑–∞–±–æ—Ä–æ–Ω |
| –Ü–∑–æ–ª—è—Ü—ñ—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (non-root, seccomp)     | ‚ùå        | –ù–µ–º–∞ securityContext —É deployment |
| –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó (drop caps, RO filesystem)| ‚ùå      | –ù–µ–º–∞ runtime-guardrails |
| Health/Readiness –ø—Ä–æ—Ç–æ–∫–æ–ª                   | ‚ùå        | –ü–æ—Ä—Ç–∏/–µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –Ω–µ —É–∑–≥–æ–¥–∂–µ–Ω—ñ |
| –ê—É–¥–∏—Ç –¥—ñ–π / —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏              | ‚ùå        | –ù–µ–º–∞ security events / request_id |

---

